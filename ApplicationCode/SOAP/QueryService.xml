<?xml version="1.0" encoding="UTF-8"?>
<Export generator="IRIS" version="26" zv="IRIS for Windows (x86-64) 2020.1 (Build 215U)" ts="2021-01-22 11:32:30">
<Class name="Application.SOAP.BS.QueryService">
<Description>
Classname Application.SOAP.BS.QueryService
Summary   消息接收字符串通用BS
Version   1.0
Date      2021年1月20日 09:00</Description>
<Super>EnsLib.SOAP.Service</Super>
<TimeChanged>65766,41498.318867</TimeChanged>
<TimeCreated>65028,39829.455217</TimeCreated>

<Parameter name="ADAPTER">
</Parameter>

<Parameter name="SERVICENAME">
<Default>QueryService</Default>
</Parameter>

<Parameter name="NAMESPACE">
<Default>http://bjgoodwillcis.com</Default>
</Parameter>

<Parameter name="SETTINGS">
<Default><![CDATA[TargetConfigNames:Basic:selector?multiSelect=0&context={Ens.ContextSearch/ProductionItems?targets=1&productionName=@productionId}]]></Default>
</Parameter>

<Property name="TargetConfigNames">
<Description>
接收消息的目标组件名称</Description>
<Type>Ens.DataType.ConfigName</Type>
</Property>

<Method name="QuerySend">
<FormalSpec>pInput:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<WebMethod>1</WebMethod>
<Implementation><![CDATA[
	TRY{
		//无发送目标告警处理
		If ""=..TargetConfigNames { $$$LOGWARNING("没有选择接收消息的目标名称，请查看BS前台设置属性!") }
		//创建返回值实例     
		Set QueryMsg= ##class(Application.MSG.QueryMsg).%New(),Parameters="",Values=""
		//获取SQL模型
		
		Set QueryMsg.Resource=$p(pInput,"?",1)
		//声明返回实例
		Set Outputobj = $System.OBJ.New("Application.MSG."_QueryMsg.Resource)
		//查询参数处理为object
		Set ParameterInfo=$p(pInput,"?",2)
		FOR i=1:1:$L(ParameterInfo,"&"){
			Set Parameters=Parameters_"+"_$p($p(ParameterInfo,"&",i),"=",1)
			Set Values=Values_$p($p(ParameterInfo,"&",i),"=",2)_","
			}
		Set QueryMsg."Query_Parameters"=Parameters,QueryMsg."Query_Values"=Values
		//发送处理
		For iTarget=1:1:$L(..TargetConfigNames, ",")
			{
			Set tSC=..ProcessInput(QueryMsg,.Outputobj,$P(..TargetConfigNames,",",iTarget))
			}
		//返回格式处理为String
		d Outputobj.XMLExportToString(.src)
	}CATCH errobj { 
		$$$LOGERROR(errobj.DisplayString())
	}
	Quit src
]]></Implementation>
</Method>

<Method name="OnProcessInput">
<FormalSpec><![CDATA[pInput:%RegisteredObject,*pOutput:%RegisteredObject,&pHint:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	//同步发送
	Set tSC=..SendRequestSync(pHint,pInput,.pOutput)
	Quit tSC
]]></Implementation>
</Method>
</Class>
</Export>
